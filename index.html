<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Avon — Products</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome (icons) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <style>
      :root{
        --brand:#db1374;
        --muted:#6c757d;
        --bg:#f6f9fc;
        --card-bg:#ffffff;
      }
      *{box-sizing:border-box}
      body{font-family:'Poppins',system-ui,Arial,Helvetica,sans-serif;background:var(--bg);color:#0b1320;margin:0;-webkit-font-smoothing:antialiased}
      .site-header{background:var(--card-bg);padding:12px 0;box-shadow:0 6px 20px rgba(12,18,26,0.04)}
      .brand{display:flex;align-items:center;gap:12px}
      .brand img{height:44px}
      .hero{padding:48px 0;text-align:center}
      .hero h1{font-weight:700;margin-bottom:8px;font-size:clamp(1.4rem,3.6vw,2.25rem)}
      .hero p{color:var(--muted);margin-bottom:18px}
      .search{max-width:700px;margin:0 auto}
      .search .form-control{border-radius:999px;padding:12px 18px;border:1px solid #e6e9ee}
      .search .btn{border-radius:999px}
      .products{padding:28px 0}
      .card-product{border-radius:14px;overflow:hidden;background:var(--card-bg);transition:transform .2s ease,box-shadow .2s ease;border:0}
      .card-product:hover{transform:translateY(-8px);box-shadow:0 24px 50px rgba(12,18,26,0.08)}
      .card-product img{width:100%;height:220px;object-fit:cover;background:linear-gradient(180deg,#fff,#f3f5f8)}
      .card-body{padding:14px}
      .card-title{font-size:1.05rem;margin-bottom:6px}
      .price{color:var(--brand);font-weight:700}
      .desc{color:#495057;font-size:0.95rem;margin-bottom:8px;min-height:48px}
      .no-items{padding:40px;text-align:center;color:#777}
      footer{padding:28px 0;text-align:center;color:#888;border-top:1px solid #eef2f6;margin-top:40px;background:transparent}
      .btn-outline-secondary{border-color:#e6e9ee;color:#374151}
      .badge-new{background:linear-gradient(90deg,#ff6ba7,#db1374);color:white;font-weight:600}
      @media (max-width:576px){
        .card-product img{height:160px}
        .hero{padding:28px 0}
      }
      @media (min-width:1200px){
        .card-product img{height:240px}
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container d-flex justify-content-between align-items-center">
        <div class="brand">
          <img src="/images/27aaa2af-994c-4d8a-8221-c5a3674cbb9b-removebg-preview_logo.png" alt="Avon Logo" onerror="this.style.display='none'">
          <div>
            <div style="font-weight:700;font-size:1.05rem">Avon</div>
            <div style="font-size:0.9rem;color:var(--muted)">Beauty · Care · Confidence</div>
          </div>
        </div>

        <div class="d-flex align-items-center gap-2">
          <a href="/admin.html" class="btn btn-outline-secondary btn-sm">Admin</a>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="hero">
        <h1>Discover Avon Favorites</h1>
        <p>Hand-picked beauty & care — click a product to view details.</p>

        <div class="search input-group mt-3 shadow-sm">
          <input id="q" class="form-control" placeholder="Search products by name..." aria-label="Search products">
          <button id="clearBtn" class="btn btn-outline-secondary" type="button"><i class="fa fa-times"></i></button>
        </div>
      </section>

      <section class="products">
        <div id="grid" class="row g-3"></div>
        <div id="empty" class="no-items" style="display:none">No products yet — check back soon.</div>
      </section>
    </main>

    <!-- Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 id="mTitle" class="modal-title"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body d-md-flex gap-3 align-items-start">
            <img id="mImage" src="" alt="" style="width:260px;height:260px;object-fit:cover;border-radius:8px;"/>
            <div>
              <p id="mDesc" class="desc"></p>
              <div class="mt-3"><span id="mPrice" class="price"></span></div>
              <div class="mt-3 text-muted"><small id="mDate"></small></div>
              <div class="mt-4">
                <button class="btn btn-primary me-2"><i class="fa fa-shopping-cart me-2"></i>Buy now</button>
                <button class="btn btn-outline-secondary">Share</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-transparent">
      <div class="container text-center py-4">
        <div class="mb-2">Join our groups</div>
        <div class="d-flex justify-content-center gap-3 mb-3">
          <a class="text-decoration-none text-muted" href="https://chat.whatsapp.com/GgyIhEltDET5qhzTocY02V" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp fa-2x"></i></a>
          <a class="text-decoration-none text-muted" href="https://youtube.com/@ahmedmohie36" target="_blank" rel="noopener"><i class="fa-brands fa-youtube fa-2x"></i></a>
          <a class="text-decoration-none text-muted" href="https://www.facebook.com" target="_blank" rel="noopener"><i class="fa-brands fa-facebook fa-2x"></i></a>
          <a class="text-decoration-none text-muted" href="https://www.tiktok.com" target="_blank" rel="noopener"><i class="fa-brands fa-tiktok fa-2x"></i></a>
        </div>
        <div class="small text-muted">&copy; Avon — Products catalog</div>
      </div>
    </footer>

    <!-- Bootstrap bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // <-- UPDATE THIS TO YOUR DEPLOYED APPS SCRIPT WEB APP URL -->
      const API = 'https://script.google.com/macros/s/AKfycbzbBa_MjYAgva6EzV3h8ZnM50w3dcVuu8t6MnNW70GK5eiQFP_GlwRiFFG0SINhcsipzA/exec';

      async function fetchItems(){
        try{
          const res = await fetch(API);
          if(!res.ok) throw new Error('Network response not ok');
          return await res.json();
        }catch(e){
          console.error('Fetch items error', e);
          return [];
        }
      }

      function formatPrice(p){
        if(p === undefined || p === null || p === '') return '';
        // normalize numeric or string
        const num = parseFloat(String(p).replace(/[^\d.\-]/g,''));
        if(!isFinite(num)) return String(p);
        return 'EGP ' + num.toLocaleString();
      }

      function createCard(it){
        const col = document.createElement('div'); col.className='col-12 col-sm-6 col-md-4 col-lg-3';
        const card = document.createElement('div'); card.className='card card-product h-100 shadow-sm';
        const img = document.createElement('img'); img.className='card-img-top'; img.alt = it.name || 'Product';
        img.src = it.imageUrl && it.imageUrl.trim() ? it.imageUrl : '/images/placeholder.png';
        img.onerror = () => { img.src = '/images/placeholder.png'; };
        const body = document.createElement('div'); body.className='card-body d-flex flex-column';
        const title = document.createElement('h5'); title.className='card-title mb-1'; title.textContent = it.name || '';
        const desc = document.createElement('p'); desc.className='desc mb-2'; desc.textContent = (it.description||'').slice(0,140);
        const bottom = document.createElement('div'); bottom.className='mt-auto d-flex justify-content-between align-items-center';
        const price = document.createElement('div'); price.className='price'; price.textContent = formatPrice(it.price||'');
        const btn = document.createElement('button'); btn.className='btn btn-sm btn-outline-primary'; btn.textContent = 'View';
        bottom.appendChild(price); bottom.appendChild(btn);
        body.appendChild(title); body.appendChild(desc); body.appendChild(bottom);
        card.appendChild(img); card.appendChild(body); col.appendChild(card);

        btn.addEventListener('click', ()=> openModal(it));
        return col;
      }

      function render(items){
        const grid = document.getElementById('grid');
        const empty = document.getElementById('empty');
        grid.innerHTML = '';
        if(!items || items.length === 0){ empty.style.display='block'; return; }
        empty.style.display='none';
        items.forEach(it => {
          grid.appendChild(createCard(it));
        });
      }

      function openModal(it){
        document.getElementById('mTitle').textContent = it.name || '';
        document.getElementById('mDesc').textContent = it.description || 'No description provided.';
        document.getElementById('mPrice').textContent = formatPrice(it.price||'');
        document.getElementById('mImage').src = it.imageUrl && it.imageUrl.trim() ? it.imageUrl : '/images/placeholder.png';
        document.getElementById('mDate').textContent = it.createdAt ? 'Added: ' + new Date(it.createdAt).toLocaleString() : '';
        new bootstrap.Modal(document.getElementById('productModal')).show();
      }

      (async ()=>{
        let items = await fetchItems();
        render(items);

        const q = document.getElementById('q');
        const clearBtn = document.getElementById('clearBtn');

        q.addEventListener('input', () => {
          const val = q.value.trim().toLowerCase();
          render(items.filter(i => (i.name||'').toLowerCase().includes(val)));
        });

        clearBtn.addEventListener('click', ()=>{ q.value=''; render(items); });
      })();
    </script>
  </body>
</html>
